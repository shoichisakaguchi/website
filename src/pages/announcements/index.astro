---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export const prerender = true;

const announcements = await getCollection("announcements");
const sortedAnnouncements = announcements.sort((a, b) => {
	if (a.data.isPinned && !b.data.isPinned) return -1;
	if (!a.data.isPinned && b.data.isPinned) return 1;
	return (
		new Date(b.data.publishedDate).valueOf() -
		new Date(a.data.publishedDate).valueOf()
	);
});
---

<Layout>
	<div class="container page-content">
		<h1 class="page-title">Announcements</h1>
		<div class="content-wrapper">
			<ul class="announcement-list">
				{
					sortedAnnouncements.map((item) => (
						<li class={item.data.isPinned ? "pinned" : ""}>
							<div class="meta">
								<span class="date">
									{item.data.publishedDate.toLocaleDateString()}
								</span>
								{item.data.isPinned && (
									<span class="badge">Pinned</span>
								)}
							</div>
							<a
								href={`/announcements/${item.slug}`}
								class="title"
							>
								{item.data.title}
							</a>
						</li>
					))
				}
			</ul>
		</div>
	</div>
</Layout>

<style>
	.page-content {
		max-width: 720px;
		margin: 0 auto;
	}

	.page-title {
		margin-top: 40px;
		margin-bottom: 40px;
		text-align: center;
	}

	.announcement-list {
		list-style: none;
		padding: 0;
	}

	.announcement-list li {
		padding: 20px 0;
		border-bottom: 1px solid var(--c-divider, #eee);
	}

	.announcement-list li:last-child {
		border-bottom: none;
	}

	.meta {
		font-size: 0.9em;
		color: var(--c-text-light, #666);
		margin-bottom: 4px;
		display: flex;
		gap: 10px;
		align-items: center;
	}

	.title {
		text-decoration: none;
		color: var(--c-text, #333);
		font-size: 1.2em;
		font-weight: 600;
		display: block;
	}

	.title:hover {
		color: var(--c-link, #0070f3);
	}

	.badge {
		background: var(--c-link, #0070f3);
		color: white;
		padding: 2px 6px;
		border-radius: 4px;
		font-size: 0.8em;
		font-weight: bold;
	}
</style>
