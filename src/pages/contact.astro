---
import Layout from "../layouts/Layout.astro";
export const prerender = true;
---

<Layout>
	<div class="container page-content">
		<h1 class="text-center page-title">Contact Us</h1>
		<p class="text-center intro-text">
			Have questions? We'd love to hear from you.
		</p>

		<form class="contact-form" id="contact-form">
			<div class="form-group">
				<label for="name">Name</label>
				<input
					type="text"
					id="name"
					name="name"
					required
					placeholder="Your Name"
				/>
			</div>

			<div class="form-group">
				<label for="email">Email</label>
				<input
					type="email"
					id="email"
					name="email"
					required
					placeholder="name@example.com"
				/>
			</div>

			<div class="form-group">
				<label for="message">Message</label>
				<textarea
					id="message"
					name="message"
					rows="5"
					required
					placeholder="How can we help?"></textarea>
			</div>

			<button type="submit" class="submit-btn">Send Message</button>
		</form>
		<div id="toast" class="toast">Message sent successfully!</div>

		<script>
			const form = document.getElementById(
				"contact-form",
			) as HTMLFormElement;
			const toast = document.getElementById("toast");
			const submitBtn = form?.querySelector(
				".submit-btn",
			) as HTMLButtonElement;

			if (form && toast && submitBtn) {
				form.addEventListener("submit", async (e) => {
					e.preventDefault();

					// Disable button and show loading state
					const originalText = submitBtn.innerText;
					submitBtn.disabled = true;
					submitBtn.innerText = "Sending...";

					try {
						const formData = new FormData(form);
						const response = await fetch("/api/contact", {
							method: "POST",
							body: formData,
						});

						const result = await response.json();

						if (response.ok) {
							form.reset();
							showToast("Message sent successfully!", "success");
						} else {
							showToast(
								result.message || "Failed to send message.",
								"error",
							);
						}
					} catch (error) {
						showToast(
							"An error occurred. Please try again.",
							"error",
						);
					} finally {
						submitBtn.disabled = false;
						submitBtn.innerText = originalText;
					}
				});

				function showToast(message: string, type: string) {
					if (!toast) return;
					toast.innerText = message;
					toast.className = `toast show ${type}`;
					setTimeout(() => {
						toast.className = toast.className.replace("show", "");
					}, 3000);
				}
			}
		</script>
	</div>
</Layout>

<style>
	.page-content {
		max-width: 600px;
		margin: 0 auto;
	}

	.page-title {
		margin-bottom: 10px;
	}

	.intro-text {
		color: var(--c-text-secondary);
		margin-bottom: 40px;
	}

	.contact-form {
		background: white;
		padding: 40px;
		border-radius: 18px;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
	}

	.form-group {
		margin-bottom: 24px;
	}

	label {
		display: block;
		font-size: 14px;
		font-weight: 600;
		margin-bottom: 8px;
		color: var(--c-text);
	}

	input,
	textarea {
		width: 100%;
		padding: 12px 16px;
		border-radius: 12px;
		border: 1px solid #d2d2d7;
		font-family: inherit;
		font-size: 16px;
		box-sizing: border-box; /* Fix padding issue */
		transition: border-color 0.2s;
	}

	input:focus,
	textarea:focus {
		outline: none;
		border-color: var(--c-link);
		box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
	}

	.submit-btn {
		width: 100%;
		background-color: var(--c-link);
		color: white;
		border: none;
		padding: 14px;
		font-size: 17px;
		font-weight: 600;
		border-radius: 12px;
		cursor: pointer;
		transition: background-color 0.2s;
	}

	.submit-btn:hover {
		background-color: var(--c-link-hover);
	}

	.submit-btn:disabled {
		opacity: 0.7;
		cursor: not-allowed;
	}

	.toast {
		visibility: hidden;
		min-width: 250px;
		background-color: #333;
		color: #fff;
		text-align: center;
		border-radius: 8px;
		padding: 16px;
		position: fixed;
		z-index: 10000;
		left: 50%;
		bottom: 30px;
		transform: translateX(-50%);
		font-size: 14px;
		opacity: 0;
		transition:
			opacity 0.3s,
			bottom 0.3s;
	}

	.toast.show {
		visibility: visible;
		opacity: 1;
		bottom: 40px;
	}

	.toast.success {
		background-color: #10b981; /* Green */
	}

	.toast.error {
		background-color: #ef4444; /* Red */
	}
</style>
